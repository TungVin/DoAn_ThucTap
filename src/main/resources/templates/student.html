<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduQuiz - Trang Ch·ªß</title>

    <link rel="stylesheet" href="/css/student.css">

    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
            integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
    />
    <link rel="icon" type="image/png" th:href="@{/img/Eduq.png}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Avatar dropdown (inline ƒë·ªÉ b·∫°n kh√¥ng c·∫ßn t·∫°o file css m·ªõi) -->
    <style>
        .avatar-wrap { position: relative; display: inline-flex; align-items: center; }

        .avatar-btn {
            background: transparent;
            border: 0;
            padding: 0;
            margin: 0;
            cursor: pointer;
            line-height: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Fallback khi ·∫£nh avatar l·ªói / ch∆∞a c√≥ */
        .avatar-fallback {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: #fff;
            background: rgba(255,255,255,0.22);
            border: 2px solid rgba(255,255,255,0.6);
            user-select: none;
        }

        .avatar-menu {
            position: absolute;
            right: 0;
            top: calc(100% + 10px);
            min-width: 220px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            overflow: hidden;
            z-index: 1000;
        }

        .avatar-menu.hidden { display: none; }

        .avatar-menu-header {
            padding: 10px 12px;
            background: #fafafa;
            border-bottom: 1px solid #eee;
        }

        .avatar-name { font-weight: 700; font-size: 14px; color: #222; }
        .avatar-email { font-size: 12px; color: #666; margin-top: 2px; }

        .avatar-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            font-size: 14px;
            color: #222;
            text-decoration: none;
        }

        .avatar-menu-item:hover { background: #f5f5f5; }
        .avatar-menu-divider { height: 1px; background: #eee; margin: 4px 0; }
        .avatar-menu-item.danger { color: #d32f2f; }
    </style>
</head>

<body>

<header class="header">
    <a href="/student">
        <div class="logo">EduQuiz</div>
    </a>

    <nav class="nav-right">
        <a class="icon-btn bell">üîî Th√¥ng b√°o</a>
        <a class="icon-btn">‚ùì H·ªó tr·ª£</a>

        <!-- Avatar dropdown -->
        <div class="avatar-wrap" id="avatarWrap">
            <button type="button" class="avatar-btn" id="avatarBtn" aria-haspopup="true" aria-expanded="false">

                <!-- Avatar th·∫≠t: l·∫•y t·ª´ session.user.avatarUrl n·∫øu c√≥ -->
                <img
                        th:src="${session.user != null && session.user.avatarUrl != null ? session.user.avatarUrl : '/images/avatar.jpg'}"
                        src="/images/avatar.jpg"
                        class="avatar"
                        alt="Avatar"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-flex';"
                >

                <!-- N·∫øu ·∫£nh l·ªói th√¨ hi·ªán ch·ªØ c√°i ƒë·∫ßu -->
                <span class="avatar-fallback" style="display:none"
                      th:text="${session.user != null && session.user.name != null && session.user.name.length() > 0
                                ? #strings.toUpperCase(#strings.substring(session.user.name,0,1))
                                : 'U'}">U</span>
            </button>

            <div class="avatar-menu hidden" id="avatarMenu">
                <div class="avatar-menu-header">
                    <div class="avatar-name" th:text="${session.user != null ? session.user.name : 'Ng∆∞·ªùi d√πng'}">Ng∆∞·ªùi d√πng</div>
                    <div class="avatar-email" th:text="${session.user != null ? session.user.email : ''}"></div>
                </div>

                <a href="/profile" class="avatar-menu-item">
                    <i class="fa-regular fa-user"></i>
                    <span>H·ªì s∆°</span>
                </a>

                <a href="/settings" class="avatar-menu-item">
                    <i class="fa-solid fa-gear"></i>
                    <span>C√†i ƒë·∫∑t</span>
                </a>

                <div class="avatar-menu-divider"></div>

                <a href="/logout" class="avatar-menu-item danger">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span>ƒêƒÉng xu·∫•t</span>
                </a>
            </div>
        </div>
    </nav>
</header>

<div class="tabs">
    <a class="tab active">B·∫£n tin</a>
    <a class="tab">L·ªãch s·ª≠ l√†m b√†i</a>
    <a class="tab">L·ªõp</a>
</div>

<div class="tab-content active">
    <div class="content">

        <div class="section">
            <h3>L·ªãch h·ªçc</h3>
            <div class="empty-box">
                <img src="/img/hientaikhongcolophoc.svg" class="empty-img" alt="Kh√¥ng c√≥ l·ªõp h·ªçc">
                <p>Hi·ªán t·∫°i kh√¥ng c√≥ l·ªõp h·ªçc</p>
            </div>
        </div>

        <div class="section">
            <h3>B√†i ki·ªÉm tra</h3>
            <div class="empty-box">
                <img src="/img/empty-quiz.png" class="empty-img" alt="Kh√¥ng c√≥ b√†i tr·∫Øc nghi·ªám">
                <p>Hi·ªán t·∫°i kh√¥ng c√≥ b√†i tr·∫Øc nghi·ªám n√†o trong l·ªãch s·ª≠ g·∫ßn ƒë√¢y</p>
            </div>
        </div>

    </div>
</div>

<div class="tab-content">
    <div class="content">

        <div class="history-top">
            <div class="search-wrapper">
                <input
                        type="text"
                        class="search-input"
                        id="searchInput"
                        placeholder="Nh·∫≠p t·ª´ kh√≥a"
                >

                <button type="button" class="clear-search-btn" id="clearSearchBtn">
                    <i class="fa-solid fa-xmark"></i>
                </button>

                <i class="fa-solid fa-magnifying-glass search-icon"></i>
            </div>

            <button class="filter-btn" type="button">
                <i class="fa-solid fa-filter"></i>
                <span>L·ªçc</span>
                <i class="fa-solid fa-chevron-down"></i>
            </button>

            <div class="filter-box hide" id="filterBox">
                <div class="filter-field">
                    <label>Lo·∫°i b√†i</label>
                    <select id="filterType">
                        <option value="">-- Ch·ªçn lo·∫°i --</option>
                        <option value="public">Public</option>
                        <option value="private">Private</option>
                    </select>
                </div>

                <div class="filter-actions">
                    <button id="cancelFilter" class="btn-cancel">H·ªßy</button>
                    <button id="applyFilter" class="btn-apply">Filter</button>
                </div>
            </div>
        </div>

        <div class="empty-box">
            <img src="/img/empty-quiz.png" class="empty-img" alt="Kh√¥ng c√≥ b√†i tr·∫Øc nghi·ªám">
            <p>Hi·ªán t·∫°i kh√¥ng c√≥ b√†i tr·∫Øc nghi·ªám n√†o trong l·ªãch s·ª≠ g·∫ßn ƒë√¢y</p>
        </div>

    </div>
</div>

<div class="tab-content">
    <div class="content">

        <div class="join-class-btn">
            <button class="primary-btn" id="openJoin">Tham gia l·ªõp</button>
        </div>

        <div class="empty-box">
            <img src="/img/no-class.svg" class="empty-img" alt="Kh√¥ng c√≥ l·ªõp">
            <p>Hi·ªán t·∫°i kh√¥ng c√≥ l·ªõp. Li√™n h·ªá ng∆∞·ªùi qu·∫£n l√Ω ƒë·ªÉ ƒë∆∞·ª£c th√™m v√†o</p>
        </div>

    </div>
</div>

<div id="overlay" class="overlay hide"></div>

<div id="joinPopup" class="join-popup hide">
    <h2>Tham gia l·ªõp</h2>

    <div class="popup-field">
        <label>M√£ l·ªõp</label>
        <input type="text" id="classCode" placeholder="Nh·∫≠p m√£ l·ªõp">
    </div>

    <div class="popup-actions">
        <button id="cancelJoin" class="btn-cancel">H·ªßy</button>
        <button id="confirmJoin" class="btn-apply">Tham gia l·ªõp</button>
    </div>
</div>

<footer class="footer">
    <div class="footer-container">

        <div class="footer-col">
            <h3>EduQuiz</h3>
            <p>N∆°i mang ƒë·∫øn tr·∫£i nghi·ªám h·ªçc t·∫≠p v√† ki·ªÉm tra hi·ªáu qu·∫£.</p>
        </div>

        <div class="footer-col">
            <h3>Li√™n h·ªá</h3>
            <p>üìç 123 L√™ L·ª£i, Qu·∫≠n 1</p>
            <p>üìû 0123 456 789</p>
            <p>üìß support@eduquiz.com</p>
            <p>‚è∞ 8:00 ‚Äì 22:00</p>
        </div>

        <div class="footer-col">
            <h3>H·ªó tr·ª£ & Ch√≠nh s√°ch</h3>
            <a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a><br>
            <a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a><br>
            <a href="#">H∆∞·ªõng d·∫´n h·ªçc & l√†m b√†i</a>
        </div>

    </div>

    <div class="footer-bottom">
        ¬© 2025 Quiz Hub. Thi·∫øt k·∫ø b·ªüi Quiz Hub Team.
    </div>
</footer>

<script src="/js/app.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("avatarBtn");
        const menu = document.getElementById("avatarMenu");
        const wrap = document.getElementById("avatarWrap");
        if (!btn || !menu || !wrap) return;

        const setExpanded = (open) => btn.setAttribute("aria-expanded", open ? "true" : "false");

        const closeMenu = () => {
            if (!menu.classList.contains("hidden")) {
                menu.classList.add("hidden");
                setExpanded(false);
            }
        };

        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            const willOpen = menu.classList.contains("hidden");
            menu.classList.toggle("hidden");
            setExpanded(willOpen);
        });

        document.addEventListener("click", (e) => {
            if (!wrap.contains(e.target)) closeMenu();
        });

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") closeMenu();
        });
    });
</script>

</body>
</html>
