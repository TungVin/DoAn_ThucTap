<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduQuiz - Teacher</title>
    <link rel="stylesheet" href="/css/teacher.css">
    <link rel="stylesheet" th:href="@{/css/Header n footer.css}">
</head>

<body>

    <!-- HEADER -->
    <header class="header">
        <div class="logo">EduQuiz</div>

        <nav class="nav-right">
            <a class="icon-btn bell">üîî Th√¥ng b√°o</a>
            <a class="icon-btn">‚ùì H·ªó tr·ª£</a>
            <img src="/images/avatar.jpg" class="avatar" alt="Avatar gi√°o vi√™n">
        </nav>
    </header>

    <!-- NAVIGATION TABS -->
    <div class="tabs" th:with="activeTab=${activeTab != null ? activeTab : 'exams'}">
        <a class="tab" th:classappend="${activeTab} == 'exams' ? ' active'" data-target="exams">B√†i ki·ªÉm tra</a>
        <a class="tab" th:classappend="${activeTab} == 'history' ? ' active'" data-target="history">L·ªãch s·ª≠</a>
        <a class="tab" th:classappend="${activeTab} == 'categories' ? ' active'" data-target="categories">Danh m·ª•c</a>
        <a class="tab" th:classappend="${activeTab} == 'online' ? ' active'" data-target="online">H·ªçc tr·ª±c tuy·∫øn</a>
        <a class="tab" th:classappend="${activeTab} == 'questions' ? ' active'" data-target="questions">Th∆∞ vi·ªán c√¢u h·ªèi</a>
        <a class="tab" th:classappend="${activeTab} == 'classes' ? ' active'" data-target="classes">L·ªõp</a>
    </div>

    <!-- PAGE CONTENT -->
    <div class="page-container">

        <div class="top-action section-block section-exams" id="examsTopAction">
            <h2>B√†i ki·ªÉm tra</h2>
            <button class="create-btn">T·∫°o b√†i ki·ªÉm tra +</button>
        </div>

        <div class="section section-block section-exams" id="examsOngoingSection">
            <h3>ƒêang di·ªÖn ra</h3>
            <div class="divider"></div>
            <div class="empty-box">
                <img src="/images/empty-quiz.png" alt="Kh√¥ng c√≥ b√†i ki·ªÉm tra">
                <p>Hi·ªán t·∫°i kh√¥ng c√≥ b√†i tr·∫Øc nghi·ªám n√†o ƒëang di·ªÖn ra</p>
            </div>
        </div>

        <div class="section section-block section-exams" id="examsDraftSection">
            <h3>ƒêang so·∫°n</h3>
            <div class="divider"></div>
            <div class="empty-box">
                <img src="/images/empty-quiz.png" alt="Kh√¥ng c√≥ b√†i ki·ªÉm tra">
                <p>Hi·ªán t·∫°i kh√¥ng c√≥ b√†i tr·∫Øc nghi·ªám n√†o trong l·ªãch s·ª≠ g·∫ßn ƒë√¢y</p>
            </div>
        </div>

        <!-- ==================== L·ªäCH S·ª¨ ==================== -->
        <div class="section section-block section-history" id="historySection">
            <div class="top-action">
                <h2>L·ªãch s·ª≠</h2>
            </div>
            <div class="divider"></div>

            <!-- C√¢u h·ªèi ƒë√£ t·∫°o g·∫ßn ƒë√¢y -->
            <h3>C√¢u h·ªèi ƒë√£ t·∫°o g·∫ßn ƒë√¢y</h3>

            <div th:if="${#lists.isEmpty(historyQuestions)}" class="empty-box">
                <img src="/images/empty-quiz.png" alt="Kh√¥ng c√≥ c√¢u h·ªèi l·ªãch s·ª≠">
                <p>Ch∆∞a c√≥ c√¢u h·ªèi n√†o ƒë∆∞·ª£c t·∫°o</p>
            </div>

            <div class="history-question-list" th:if="${!#lists.isEmpty(historyQuestions)}">
                <div class="history-question-item" th:each="q : ${historyQuestions}">
                    <div class="history-question-main">
                        <div class="history-question-title" th:text="${q.title}"></div>
                        <div class="history-question-meta">
                            <span th:text="${q.category != null ? q.category.name : 'Kh√¥ng c√≥ danh m·ª•c'}"></span>
                            <span>|</span>
                            <span th:text="${q.type}"></span>
                            <span th:if="${q.createdAt != null}">
                                | <span th:text="${#temporals.format(q.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- B√†i ki·ªÉm tra ƒë√£ t·∫°o g·∫ßn ƒë√¢y -->
            <h3 style="margin-top:24px;">B√†i ki·ªÉm tra ƒë√£ t·∫°o g·∫ßn ƒë√¢y</h3>

            <div th:if="${#lists.isEmpty(historyExams)}" class="empty-box">
                <img src="/images/empty-quiz.png" alt="Kh√¥ng c√≥ b√†i ki·ªÉm tra l·ªãch s·ª≠">
                <p>Ch∆∞a c√≥ b√†i ki·ªÉm tra n√†o ƒë∆∞·ª£c t·∫°o</p>
            </div>

            <div class="history-exam-list" th:if="${!#lists.isEmpty(historyExams)}">
                <div class="history-exam-item" th:each="e : ${historyExams}">
                    <div class="history-exam-main">
                        <div class="history-exam-title" th:text="${e.title}"></div>
                        <div class="history-exam-meta">
                            <span th:text="${e.subject != null ? e.subject : 'Kh√¥ng c√≥ m√¥n h·ªçc'}"></span>
                            <span th:if="${e.createdAt != null}">
                                | <span th:text="${#temporals.format(e.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== H·ªåC TR·ª∞C TUY·∫æN ==================== -->
        <div class="section section-block section-online" id="onlineLearningSection">
            <div class="top-action">
                <h2>H·ªçc tr·ª±c tuy·∫øn</h2>
                <button class="create-btn" id="openAddScheduleModal" type="button" onclick="(function(){var m=document.getElementById('addScheduleModal'); if(m){ m.classList.add('show'); m.style.display='flex'; } })()">Th√™m l·ªãch h·ªçc +</button>
            </div>

            <div class="divider"></div>

            <div th:if="${#lists.isEmpty(schedules)}" class="empty-box">
                <img src="/images/empty-quiz.png" alt="Kh√¥ng c√≥ l·ªãch h·ªçc">
                <p>Ch∆∞a c√≥ l·ªãch h·ªçc tr·ª±c tuy·∫øn n√†o</p>
            </div>

            <div th:if="${!#lists.isEmpty(schedules)}" class="schedule-list">
                <div class="schedule-item" th:each="s : ${schedules}">
                    <div class="schedule-title" th:text="${s.title}"></div>
                    <div class="schedule-time" th:text="${#temporals.format(s.startTime, 'dd/MM/yyyy HH:mm')} + ' - ' + ${#temporals.format(s.endTime, 'dd/MM/yyyy HH:mm')}"></div>
                    <div class="schedule-platform" th:text="${s.platform}"></div>
                    <div class="schedule-auto" th:text="${s.autoAccept} ? 'T·ª± ƒë·ªông ch·∫•p nh·∫≠n: B·∫≠t' : 'T·ª± ƒë·ªông ch·∫•p nh·∫≠n: T·∫Øt'"></div>
                </div>
            </div>
        </div>

        <!-- ==================== DANH M·ª§C ==================== -->
        <div class="section section-block section-categories" id="categoriesSection">
            <div class="top-action">
                <h2>Danh m·ª•c</h2>
                <button class="create-btn" id="openAddCategoryModal" type="button" onclick="(function(){var m=document.getElementById('addCategoryModal'); if(m){ m.classList.add('show'); m.style.display='flex'; } })()">Th√™m danh m·ª•c +</button>
            </div>
            <div class="divider"></div>

            <div th:if="${#lists.isEmpty(categories)}" class="empty-box">
                <img src="/images/empty-quiz.png" alt="Kh√¥ng c√≥ danh m·ª•c">
                <p>Ch∆∞a c√≥ danh m·ª•c n√†o</p>
            </div>

            <div th:if="${!#lists.isEmpty(categories)}" class="category-list">
                <div class="category-item" th:each="c : ${categories}">
                    <div class="category-name" th:text="${c.name}"></div>
                    <div class="category-desc" th:text="${c.description}"></div>
                </div>
            </div>
        </div>

        <!-- ==================== TH∆Ø VI·ªÜN C√ÇU H·ªéI ==================== -->
        <div class="section section-block section-questions" id="questionLibrarySection">
            <div class="top-action">
                <h2>Th∆∞ vi·ªán c√¢u h·ªèi</h2>
                <button class="create-btn" id="openCreateQuestionModal" type="button">T·∫°o c√¢u h·ªèi +</button>
            </div>
            <div class="divider"></div>
            <div class="empty-box" th:if="${#lists.isEmpty(questions)}">
                <img src="/images/empty-quiz.png" alt="Kh√¥ng c√≥ c√¢u h·ªèi">
                <p>Ch∆∞a c√≥ c√¢u h·ªèi n√†o trong th∆∞ vi·ªán</p>
            </div>
            <div class="question-list" th:if="${!#lists.isEmpty(questions)}">
                <div class="question-item" th:each="q : ${questions}">
                    <div class="question-title" th:text="${q.title}"></div>
                    <div class="question-category" th:text="${q.category?.name}"></div>
                    <div class="question-type" th:text="${q.type}"></div>
                </div>
            </div>
        </div>

        <!-- ==================== L·ªöP H·ªåC ==================== -->
        <div class="section section-block section-classes" id="classesSection">
            <div class="top-action">
                <h2>L·ªõp h·ªçc</h2>
                <button class="create-btn" id="openAddClassModal" type="button" onclick="(function(){var m=document.getElementById('addClassModal'); if(m){ m.classList.add('show'); m.style.display='flex'; } })()">Th√™m l·ªõp h·ªçc +</button>
            </div>
            <div class="divider"></div>

            <div th:if="${classSuccess}" class="alert success" th:text="${classSuccess}"></div>
            <div th:if="${classError}" class="alert error" th:text="${classError}"></div>

            <div th:if="${#lists.isEmpty(classes)}" class="empty-box">
                <img src="/images/empty-quiz.png" alt="Kh√¥ng c√≥ l·ªõp h·ªçc">
                <p>Ch∆∞a c√≥ l·ªõp h·ªçc n√†o</p>
            </div>

            <div th:if="${!#lists.isEmpty(classes)}" class="class-list">
                <div class="class-item" th:each="c : ${classes}">
                    <div class="class-image" th:if="${c.imagePath != null}">
                        <img th:src="${c.imagePath}" alt="·∫¢nh l·ªõp">
                    </div>
                    <div class="class-info">
                        <h4 th:text="${c.name}"></h4>
                        <p th:text="${c.description}"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div th:replace="~{fragments/Footer :: footer}"></div>


    <!-- ==================== MODAL T·∫†O B√ÄI KI·ªÇM TRA ==================== -->
    <div id="createQuizModal" class="modal-overlay">

        <div class="modal-container">

            <div class="modal-topbar">
                <span id="closeModal" class="close-btn">‚úï</span>

                <div class="modal-tabs">
                    <span class="modal-tab active">B√†i ki·ªÉm tra</span>
                    <span class="modal-tab">B√†i n·ªôp</span>
                </div>

                <div class="modal-actions">
                    <button class="preview-btn">üëÅÔ∏è Xem tr∆∞·ªõc</button>
                    <button class="export-btn">‚¨á Export</button>
                    <button class="draft-btn">L∆∞u nh√°p</button>
                    <button class="publish-btn">ƒêƒÉng b√†i</button>
                </div>
            </div>

            <div class="modal-body">

                <!-- ================== TH√îNG TIN CHUNG ================== -->
                <div class="modal-card">
                    <h3>Th√¥ng tin chung</h3>

                    <input type="text" class="input" placeholder="Ti√™u ƒë·ªÅ b√†i ki·ªÉm tra">
                    <textarea class="textarea" placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn"></textarea>

                    <h4>Thi·∫øt l·∫≠p ƒë·ªëi t∆∞·ª£ng l√†m b√†i</h4>

                    <label class="switch-row">
                        <input id="publicToggle" type="checkbox" checked>
                        <div class="switch"><div class="slider"></div></div>
                        <span>C√¥ng khai</span>
                    </label>

                    <p class="link">https://app.eduquiz.com/ABC123</p>

                    <button class="share-btn">üì§ Chia s·∫ª</button>

                    <h4>C√†i ƒë·∫∑t th·ªùi gian</h4>


                    <!-- ===================== TH·ªúI GIAN L√ÄM B√ÄI ===================== -->
                    <div class="time-block">
                        <label class="switch-row">
                            <input id="timeLimitToggle" type="checkbox">
                            <div class="switch"><div class="slider"></div></div>
                            <span>Th·ªùi gian l√†m b√†i</span>
                        </label>
                        <p class="desc">Th·ªùi gian t·ªëi ƒëa l√†m b√†i ki·ªÉm tra khi b·∫Øt ƒë·∫ßu l√†m</p>

                        <div class="time-flex">
                            <input id="timeLimitInput" type="number" class="time-input" value="0" disabled>
                            <span>Ph√∫t</span>
                        </div>
                    </div>

                    <hr>

                    <!-- ===================== TH·ªúI GIAN B·∫ÆT ƒê·∫¶U ===================== -->
                    <div class="time-block">
                        <label class="switch-row">
                            <input id="startToggle" type="checkbox">
                            <div class="switch"><div class="slider"></div></div>
                            <span>Th·ªùi gian b·∫Øt ƒë·∫ßu l√†m b√†i</span>
                        </label>

                        <p class="desc">
                            Ng∆∞·ªùi d√πng ch·ªâ c√≥ th·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i trong ho·∫∑c sau th·ªùi gian n√†y.
                        </p>

                        <div class="datetime-row">
                            <input id="startTime" type="time" class="dt-input" disabled>
                            <input id="startDate" type="date" class="dt-input" disabled>
                            <span class="calendar-icon">üìÖ</span>
                        </div>
                    </div>

                    <hr>

                    <!-- ===================== TH·ªúI GIAN K·∫æT TH√öC ===================== -->
                    <div class="time-block">
                        <label class="switch-row">
                            <input id="endToggle" type="checkbox">
                            <div class="switch"><div class="slider"></div></div>
                            <span>Th·ªùi gian k·∫øt th√∫c l√†m b√†i</span>
                        </label>

                        <p class="desc">
                            N·∫øu ƒë·∫øn th·ªùi ƒëi·ªÉm n√†y, b√†i l√†m s·∫Ω b·ªã kh√≥a ho·∫∑c t·ª± ƒë·ªông n·ªôp.
                        </p>

                        <div class="datetime-row">
                            <input id="endTime" type="time" class="dt-input" disabled>
                            <input id="endDate" type="date" class="dt-input" disabled>
                            <span class="calendar-icon">üìÖ</span>
                        </div>
                    </div>
                </div>



                <!-- ================== PH·∫¶N 1 ================== -->
                <div class="modal-card">
                    <h3>Ph·∫ßn 1</h3>

                    <input class="input" placeholder="Nh·∫≠p n·ªôi dung c√¢u h·ªèi?">

                    <div class="answer">
                        <input type="radio" name="ans1">
                        <input class="answer-text" placeholder="C√¢u tr·∫£ l·ªùi...">
                    </div>

                    <div class="answer">
                        <input type="radio" name="ans1">
                        <input class="answer-text" placeholder="C√¢u tr·∫£ l·ªùi...">
                    </div>

                    <div class="answer">
                        <input type="radio" name="ans1">
                        <input class="answer-text" placeholder="C√¢u tr·∫£ l·ªùi...">
                    </div>

                    <div class="answer">
                        <input type="radio" name="ans1">
                        <input class="answer-text" placeholder="C√¢u tr·∫£ l·ªùi...">
                    </div>

                    <button class="add-answer">+ Th√™m c√¢u tr·∫£ l·ªùi</button>
                </div>


                
                <!-- ==================== C√ÄI ƒê·∫∂T N√ÇNG CAO ==================== -->
<div class="modal-card">
    <h3>C√†i ƒë·∫∑t n√¢ng cao</h3>

    <!-- Hi·ªÉn th·ªã k·∫øt qu·∫£ -->
    <h4>Hi·ªÉn th·ªã k·∫øt qu·∫£ tr·∫Øc nghi·ªám:</h4>

    <div class="row-setting">
        <span>ƒêi·ªÉm t·ªëi ƒëa cho b√†i ki·ªÉm tra</span>
        <input type="number" id="maxScore" class="small-input" value="10">
    </div>

    <div class="switch-row">
        <input type="checkbox" id="autoScoreToggle" checked>
        <div class="switch"><div class="slider"></div></div>
        <span>H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông chia ƒëi·ªÉm</span>
    </div>

    <div class="row-setting">
        <span>K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã</span>

        <select id="resultOption" class="select">
            <option value="after_teacher">Sau khi gi√°o vi√™n ch·∫•m b√†i</option>
            <option value="after_submit">Ngay sau khi n·ªôp b√†i</option>
            <option value="after_all">Khi t·∫•t c·∫£ h·ªçc sinh n·ªôp b√†i</option>
        </select>
    </div>

    <div class="switch-row">
        <input type="checkbox" id="showStudentWorkToggle">
        <div class="switch"><div class="slider"></div></div>
        <span>Cho ph√©p hi·ªÉn th·ªã b√†i l√†m c·ªßa h·ªçc sinh</span>
    </div>

    <hr style="margin:18px 0; opacity:.3;">

    <!-- C√¢u h·ªèi & c√¢u tr·∫£ l·ªùi -->
    <h4>Hi·ªÉn th·ªã c√¢u h·ªèi v√† c√¢u tr·∫£ l·ªùi</h4>

    <div class="row-2col">
        <div>
            <label>S·ªë th·ª© t·ª± c√¢u h·ªèi</label>
            <select id="questionIndex" class="select">
                <option value="ABC">A, B, C‚Ä¶</option>
                <option value="123">1, 2, 3‚Ä¶</option>
            </select>
        </div>

        <div>
            <label>S·ªë c√¢u h·ªèi tr√™n trang</label>
            <select id="questionPerPage" class="select">
                <option>10</option>
                <option selected>50</option>
                <option>100</option>
            </select>
        </div>
    </div>

    <div class="row-2col">
        <div>
            <label>S·ªë c√¢u tr·∫£ l·ªùi tr√™n 1 h√†ng</label>
            <input type="number" id="answerPerRow" class="small-input" value="1">
        </div>

        <div>
            <label>S·ªë l·∫ßn n·ªôp b√†i</label>
            <input type="number" id="submitLimit" class="small-input" value="100">
        </div>
    </div>
</div>


            </div>
        </div>

    </div>

    <!-- ==================== MODAL TH√äM L·ªäCH H·ªåC ==================== -->
    <div id="addScheduleModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-topbar">
                <span id="closeAddScheduleModal" class="close-btn">‚úï</span>
                <h3>Th√™m l·ªãch h·ªçc</h3>
                <div class="modal-actions"></div>
            </div>

            <div class="modal-body">
                <form id="addScheduleForm" method="post" th:action="@{/teacher/schedules}">
                    <div class="modal-card">
                        <label>Ti√™u ƒë·ªÅ</label>
                        <input type="text" name="title" class="input" placeholder="Ti√™u ƒë·ªÅ bu·ªïi h·ªçc" required>

                        <h4>Th·ªùi gian b·∫Øt ƒë·∫ßu</h4>
                        <div class="datetime-row">
                            <input type="date" id="startDateSchedule" class="dt-input" required>
                            <input type="time" id="startTimeSchedule" class="dt-input" required>
                        </div>

                        <h4>Th·ªùi gian k·∫øt th√∫c</h4>
                        <div class="datetime-row">
                            <input type="date" id="endDateSchedule" class="dt-input" required>
                            <input type="time" id="endTimeSchedule" class="dt-input" required>
                        </div>

                        <input type="hidden" name="startTime" id="startDateTimeHidden">
                        <input type="hidden" name="endTime" id="endDateTimeHidden">

                        <h4>H√¨nh th·ª©c h·ªçc</h4>
                        <select name="platform" class="select" required>
                            <option value="microsoft_teams">Microsoft Teams</option>
                            <option value="zoom">Zoom</option>
                            <option value="google_meet">Google Meet</option>
                        </select>

                        <div class="switch-row" style="margin-top:12px;">
                            <input type="checkbox" id="autoAcceptToggle">
                            <div class="switch"><div class="slider"></div></div>
                            <span>T·ª± ƒë·ªông ch·∫•p nh·∫≠n y√™u c·∫ßu tham gia l·ªõp</span>
                            <input type="hidden" name="autoAccept" id="autoAcceptHidden" value="false">
                        </div>

                        <div style="margin-top:16px; display:flex; gap:10px; justify-content:flex-end;">
                            <button type="button" class="export-btn" onclick="(function(){var m=document.getElementById('addScheduleModal'); if(m){ m.classList.remove('show'); m.style.display=''; } })()">H·ªßy</button>
                            <button type="submit" class="publish-btn">Th√™m</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL TH√äM DANH M·ª§C ==================== -->
    <div id="addCategoryModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-topbar">
                <span id="closeAddCategoryModal" class="close-btn">‚úï</span>
                <h3>Th√™m danh m·ª•c</h3>
                <div class="modal-actions"></div>
            </div>
            <div class="modal-body">
                <form method="post" th:action="@{/teacher/categories}">
                    <div class="modal-card">
                        <label>T√™n danh m·ª•c</label>
                        <input type="text" name="name" class="input" placeholder="V√≠ d·ª•: To√°n, VƒÉn" required>
                        <label style="margin-top:10px;">M√¥ t·∫£ (tu·ª≥ ch·ªçn)</label>
                        <textarea name="description" class="textarea" placeholder="M√¥ t·∫£ ng·∫Øn"></textarea>
                        <div style="margin-top:16px; display:flex; gap:10px; justify-content:flex-end;">
                            <button type="button" class="export-btn" onclick="(function(){var m=document.getElementById('addCategoryModal'); if(m){ m.classList.remove('show'); m.style.display=''; } })()">H·ªßy</button>
                            <button type="submit" class="publish-btn">Th√™m</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL T·∫†O C√ÇU H·ªéI ==================== -->
    <div id="createQuestionModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-topbar">
                <span id="closeCreateQuestionModal" class="close-btn">‚úï</span>
                <h3>T·∫°o c√¢u h·ªèi</h3>
                <div class="modal-actions"></div>
            </div>

            <div class="modal-body">
                <form id="createQuestionForm" method="post" th:action="@{/teacher/questions}" enctype="multipart/form-data">
                    <div class="modal-card">
                        <label>Danh m·ª•c</label>
                        <select name="categoryId" class="select" required>
                            <option th:each="c : ${categories}" th:value="${c.id}" th:text="${c.name}"></option>
                        </select>

                        <label style="margin-top:10px;">Ti√™u ƒë·ªÅ c√¢u h·ªèi</label>
                        <input type="text" name="title" class="input" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ c√¢u h·ªèi" required>

                        <label style="margin-top:10px;">N·ªôi dung c√¢u h·ªèi</label>
                        <textarea name="content" class="textarea" placeholder="M√¥ t·∫£ chi ti·∫øt c√¢u h·ªèi" required></textarea>

                        <h4>T·ªáp ƒë√≠nh k√®m (tu·ª≥ ch·ªçn)</h4>
                        <div class="row-2col">
                            <div>
                                <label>H√¨nh ·∫£nh</label>
                                <input type="file" name="image" accept="image/*" class="input">
                            </div>
                            <div>
                                <label>√Çm thanh</label>
                                <input type="file" name="audio" accept="audio/*" class="input">
                            </div>
                        </div>
                        <div style="margin-top:10px;">
                            <label>Video</label>
                            <input type="file" name="video" accept="video/*" class="input">
                        </div>

                        <h4 style="margin-top:16px;">H√¨nh th·ª©c c√¢u h·ªèi</h4>
                        <select name="type" id="questionTypeSelect" class="select" required>
                            <option value="single_choice">Tr·∫Øc nghi·ªám (ch·ªçn 1 ƒë√°p √°n)</option>
                            <option value="multiple_choice">Tr·∫Øc nghi·ªám (nhi·ªÅu ƒë√°p √°n)</option>
                            <option value="short_answer">C√¢u tr·∫£ l·ªùi ng·∫Øn</option>
                            <option value="best_short_answer">C√¢u tr·∫£ l·ªùi ng·∫Øn ƒë√∫ng nh·∫•t</option>
                            <option value="match_pairs">N·ªëi c√°c ƒë√°p √°n ƒë√∫ng</option>
                            <option value="yes_no">C√¢u h·ªèi C√≥/Kh√¥ng</option>
                            <option value="true_false">ƒê√∫ng/Sai</option>
                        </select>

                        <!-- Dynamic area for options based on type -->
                        <div id="questionOptionsArea" style="margin-top:14px;"></div>

                        <div style="margin-top:16px; display:flex; gap:10px; justify-content:flex-end;">
                            <button type="button" class="export-btn" id="cancelCreateQuestionBtn">H·ªßy</button>
                            <button type="submit" class="publish-btn">Th√™m</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL TH√äM L·ªöP H·ªåC ==================== -->
    <div id="addClassModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-topbar">
                <span id="closeAddClassModal" class="close-btn">‚úï</span>
                <h3>Th√™m l·ªõp h·ªçc</h3>
                <div class="modal-actions"></div>
            </div>
            <div class="modal-body">
                <form id="addClassForm" method="post" th:action="@{/teacher/classes}" enctype="multipart/form-data">
                    <div class="modal-card">
                        <label>T√™n l·ªõp h·ªçc</label>
                        <input type="text" name="name" class="input" placeholder="Nh·∫≠p t√™n l·ªõp h·ªçc" required>

                        <label style="margin-top:10px;">M√¥ t·∫£ (tu·ª≥ ch·ªçn)</label>
                        <textarea name="description" class="textarea" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ l·ªõp h·ªçc"></textarea>

                        <label style="margin-top:10px;">·∫¢nh ƒë·∫°i di·ªán (tu·ª≥ ch·ªçn)</label>
                        <input type="file" name="image" accept="image/*" class="input">

                        <div style="margin-top:16px; display:flex; gap:10px; justify-content:flex-end;">
                            <button type="button" class="export-btn" onclick="(function(){var m=document.getElementById('addClassModal'); if(m){ m.classList.remove('show'); m.style.display=''; } })()">H·ªßy</button>
                            <button type="submit" class="publish-btn">Th√™m</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="/js/teacher.js"></script>
    <script>
        // Compose datetime-local strings acceptable by ISO DATE_TIME for Spring
        function composeDateTime(dateStr, timeStr) {
            return dateStr + 'T' + timeStr + ':00'; // seconds default
        }
        const addForm = document.getElementById('addScheduleForm');
        const startDateEl = document.getElementById('startDateSchedule');
        const startTimeEl = document.getElementById('startTimeSchedule');
        const endDateEl = document.getElementById('endDateSchedule');
        const endTimeEl = document.getElementById('endTimeSchedule');
        const startHidden = document.getElementById('startDateTimeHidden');
        const endHidden = document.getElementById('endDateTimeHidden');
        const autoToggle = document.getElementById('autoAcceptToggle');
        const autoHidden = document.getElementById('autoAcceptHidden');

        // open/close modal
        const openAddBtn = document.getElementById('openAddScheduleModal');
        const addModal = document.getElementById('addScheduleModal');
        const closeAddBtn = document.getElementById('closeAddScheduleModal');
        if (openAddBtn) openAddBtn.addEventListener('click', ()=> { addModal.classList.add('show'); addModal.style.display = 'flex'; });
        if (closeAddBtn) closeAddBtn.addEventListener('click', ()=> { addModal.classList.remove('show'); addModal.style.display = ''; });
        window.addEventListener('click', (e)=>{ if(e.target===addModal) { addModal.classList.remove('show'); addModal.style.display = ''; } });

        // toggle auto accept hidden value
        autoToggle.addEventListener('change', ()=>{ autoHidden.value = autoToggle.checked ? 'true' : 'false'; });

        // set min dates today
        const today = new Date().toISOString().split('T')[0];
        startDateEl.min = today; endDateEl.min = today;

        // form submit hook
        addForm.addEventListener('submit', (e)=>{
            startHidden.value = composeDateTime(startDateEl.value, startTimeEl.value);
            endHidden.value = composeDateTime(endDateEl.value, endTimeEl.value);
        });


        // close category modal via x
        (function(){
          const catModal = document.getElementById('addCategoryModal');
          const closeCatBtn = document.getElementById('closeAddCategoryModal');
          if (closeCatBtn) closeCatBtn.addEventListener('click', ()=>{ catModal.classList.remove('show'); catModal.style.display=''; });
          window.addEventListener('click', (e)=>{ if(e.target===catModal){ catModal.classList.remove('show'); catModal.style.display=''; } });
        })();

        // ===================== QUESTION MODAL =====================
        (function(){
          const qSection = document.getElementById('questionLibrarySection');
          const openQBtn = document.getElementById('openCreateQuestionModal');
          const qModal = document.getElementById('createQuestionModal');
          const closeQBtn = document.getElementById('closeCreateQuestionModal');
          const cancelQBtn = document.getElementById('cancelCreateQuestionBtn');
          const typeSelect = document.getElementById('questionTypeSelect');
          const optionsArea = document.getElementById('questionOptionsArea');

          function renderTypeUI(type){
            const makeOptionRow = (idx)=>`<div class=\"answer\"><input type=\"checkbox\" name=\"correctIndexes\" value=\"${idx}\" ${type==='single_choice'?'style=\\'display:none\\'':''}><input class=\"answer-text\" name=\"options\" placeholder=\"ƒê√°p √°n ${idx+1}\"></div>`;
            if(type==='single_choice' || type==='multiple_choice'){
              optionsArea.innerHTML = `
                <div>
                  <p style=\"margin:6px 0;color:#666\">Th√™m c√°c ƒë√°p √°n v√† ch·ªçn ƒë√°p √°n ƒë√∫ng${type==='single_choice'?' (ch·ªâ m·ªôt)':''}.</p>
                  <div id=\"optionsList\">${[0,1,2,3].map(makeOptionRow).join('')}</div>
                  <button type=\"button\" class=\"add-answer\" id=\"addOptionBtn\">+ Th√™m ƒë√°p √°n</button>
                </div>`;
              const optionsList = optionsArea.querySelector('#optionsList');
              const addBtn = optionsArea.querySelector('#addOptionBtn');
              let count = 4;
              addBtn.addEventListener('click', ()=>{ optionsList.insertAdjacentHTML('beforeend', makeOptionRow(count++)); });
              if(type==='single_choice'){
                optionsArea.querySelectorAll('input[type=checkbox]').forEach((cb,i)=>{
                  const radio = document.createElement('input');
                  radio.type='radio'; radio.name='correctIndex'; radio.value=String(i);
                  cb.replaceWith(radio);
                });
              }
            } else if(type==='short_answer' || type==='best_short_answer'){
              optionsArea.innerHTML = `
                <div>
                  <label>ƒê√°p √°n m·∫´u (tu·ª≥ ch·ªçn)</label>
                  <input type=\"text\" name=\"sampleAnswer\" class=\"input\" placeholder=\"Nh·∫≠p ƒë√°p √°n m·∫´u\">
                </div>`;
            } else if(type==='match_pairs'){
              optionsArea.innerHTML = `
                <div>
                  <p style=\"margin:6px 0;color:#666\">Nh·∫≠p c√°c c·∫∑p c·∫ßn n·ªëi.</p>
                  <div id=\"pairsList\">
                    <div class=\"row-2col\">
                      <input class=\"input\" name=\"left\" placeholder=\"Tr√°i 1\">
                      <input class=\"input\" name=\"right\" placeholder=\"Ph·∫£i 1\">
                    </div>
                    <div class=\"row-2col\">
                      <input class=\"input\" name=\"left\" placeholder=\"Tr√°i 2\">
                      <input class=\"input\" name=\"right\" placeholder=\"Ph·∫£i 2\">
                    </div>
                  </div>
                  <button type=\"button\" class=\"add-answer\" id=\"addPairBtn\">+ Th√™m c·∫∑p</button>
                </div>`;
              const pairsList = optionsArea.querySelector('#pairsList');
              const addPairBtn = optionsArea.querySelector('#addPairBtn');
              let idx = 3;
              addPairBtn.addEventListener('click', ()=>{
                pairsList.insertAdjacentHTML('beforeend', `<div class=\"row-2col\"><input class=\"input\" name=\"left\" placeholder=\"Tr√°i ${idx}\"><input class=\"input\" name=\"right\" placeholder=\"Ph·∫£i ${idx}\"></div>`);
                idx++;
              });
            } else if(type==='yes_no'){
              optionsArea.innerHTML = `
                <div class=\"answer\">
                    <label><input type=\"radio\" name=\"yn\" value=\"yes\"> C√≥</label>
                    <label style=\"margin-left:12px\"><input type=\"radio\" name=\"yn\" value=\"no\"> Kh√¥ng</label>
                </div>`;
            } else if(type==='true_false'){
              optionsArea.innerHTML = `
                <div class=\"answer\">
                    <label><input type=\"radio\" name=\"tf\" value=\"true\"> ƒê√∫ng</label>
                    <label style=\"margin-left:12px\"><input type=\"radio\" name=\"tf\" value=\"false\"> Sai</label>
                </div>`;
            }
          }
          if(typeSelect){ renderTypeUI(typeSelect.value); typeSelect.addEventListener('change', ()=>renderTypeUI(typeSelect.value)); }

          function closeModal(){ qModal.classList.remove('show'); qModal.style.display=''; }
          if(openQBtn) openQBtn.addEventListener('click', ()=>{ qModal.classList.add('show'); qModal.style.display='flex'; });
          if(closeQBtn) closeQBtn.addEventListener('click', closeModal);
          if(cancelQBtn) cancelQBtn.addEventListener('click', closeModal);
          window.addEventListener('click', (e)=>{ if(e.target===qModal){ closeModal(); } });
        })();

        // ===================== TAB SWITCHING =====================
        (function(){
          const tabEls = document.querySelectorAll('.tabs .tab');
          const sectionMap = {
            exams: ['section-exams'],
            history: ['section-history'],
            categories: ['section-categories'],
            online: ['section-online'],
            questions: ['section-questions'],
            classes: ['section-classes']
          };

          function setActiveTab(targetKey){
            // active class cho tab
            tabEls.forEach(t=>{
              if(t.getAttribute('data-target') === targetKey){
                t.classList.add('active');
              } else {
                t.classList.remove('active');
              }
            });

            // ·∫©n/hi·ªán section
            const allSections = document.querySelectorAll('.section-block');
            allSections.forEach(sec => {
              sec.classList.add('hidden-by-tab');
            });

            const keys = sectionMap[targetKey] || [];
            keys.forEach(k => {
              document.querySelectorAll('.' + k).forEach(sec => {
                sec.classList.remove('hidden-by-tab');
              });
            });
          }

          tabEls.forEach(t => {
            t.addEventListener('click', () => {
              const key = t.getAttribute('data-target');
              setActiveTab(key);
            });
          });

          // Kh·ªüi t·∫°o: n·∫øu server truy·ªÅn activeTab th√¨ d√πng, m·∫∑c ƒë·ªãnh exams
          const serverActiveTab = /*[[${activeTab}]]*/ 'exams';
          setActiveTab(serverActiveTab || 'exams');
        })();
    </script>
</body>
</html>
